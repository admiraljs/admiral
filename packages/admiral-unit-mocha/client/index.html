<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Test</title>
    <link rel="stylesheet" href="/mocha/lib/mocha.css"/>
  </head>

  <body>
    <div id="mocha"></div>

    <script src="/mocha/lib/mocha.js"></script>
    <script>mocha.setup({{{config}}});</script>
    {{#tests}}
    <script src="{{{.}}}"></script>
    {{/tests}}
    <script>
      (function () {
        var runner = mocha.run();
        var failed = [];

        var _flattenTitles = function (test) {
          var titles = [];

          while (test.parent.title) {
            titles.unshift(test.parent.title);
            test = test.parent;
          }

          return titles;
        };

        runner.on('fail', function (test, err) {
          failed.push({
            name: test.title,
            result: false,
            message: err.message,
            stack: err.stack,
            titles: _flattenTitles(test)
          });
        });

        runner.on('end', function () {
          window.mochaResults = runner.stats;
          window.mochaResults.reports = failed;
        });
      })();
    </script>
  </body>
</html>
